{% extends "accounts/dashboards/base_dashboard.html" %}

{% block page_title %}Team: {{ team.name }}{% endblock %}
{% block page_subtitle %}Manage team members and captain{% endblock %}

{% block content %}

<!-- âœ… Back button (correct place) -->
<div style="margin-bottom:1.5rem;">
    <a href="{% url 'accounts:faculty_coordinator_dashboard' %}"
       class="btn-action btn-outline"
       style="width:auto; display:inline-block;">
        â¬… Back to Dashboard
    </a>
</div>

<div class="dashboard-grid">

    <!-- Team Info + Team Strength -->
    <div class="glass-card">
        <div class="card-header">
            <h3 class="card-title">ğŸ· Team Details</h3>
        </div>
        <p>
            <strong>Players:</strong>
            {{ current_count }} / {{ max_size }}
        </p>


        <p><strong>Team Name:</strong> {{ team.name }}</p>

        <a href="{% url 'accounts:edit_team' team.id %}" class="btn-action">
            âœ Edit Team Name
        </a>

        {% if meet_event.event.event_type == "TEAM" %}
        <hr>

        <h4>ğŸ‘¥ Team Strength</h4>

        <form method="post">
            {% csrf_token %}
            <input type="hidden" name="update_team_strength" value="1">

            <div style="display:flex; gap:15px;">
                <div>
                    <label>Minimum Players</label>
                    <input type="number"
                        name="min_team_size"
                        value="{{ meet_event.min_team_size }}"
                        min="1"
                        required>
                </div>

                <div>
                    <label>Maximum Players</label>
                    <input type="number"
                        name="max_team_size"
                        value="{{ meet_event.max_team_size }}"
                        min="1"
                        required>
                </div>
            </div>

            <button class="btn-action" style="margin-top:10px;">
                ğŸ’¾ Update Team Strength
            </button>
        </form>
        {% endif %}
    </div>



    <!-- Add Member -->
    <div class="glass-card">
        <div class="card-header">
            <h3 class="card-title">â• Add Member</h3>
        </div>

        {% if is_full %}
            <p style="color:red; font-weight:600;">
                ğŸš« Team is full. Cannot add more members.
            </p>
        {% else %}
            <form method="post">
                {% csrf_token %}

                <label>Select Student</label>
                <select name="student" required>
                    {% for s in students %}
                    <option value="{{ s.id }}">
                        {{ s.full_name }} ({{ s.register_number }})
                    </option>
                    {% endfor %}
                </select>

                <button type="submit" class="btn-action">
                    â• Add to Team
                </button>
            </form>
        {% endif %}
    </div>


    <!-- Team Members -->
    <div class="glass-card" style="grid-column: span 2;">
        <div class="card-header">
            <h3 class="card-title">ğŸ‘¥ Team Members</h3>
        </div>

        {% if members %}
        <div style="overflow-x:auto;">
            <table class="table">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Register No</th>
                        <th>Role</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for m in members %}
                    <tr>
                        <td>{{ m.student.full_name }}</td>
                        <td>{{ m.student.register_number }}</td>
                        <td>
                            {% if m.is_captain %}
                                ğŸ§¢ Captain
                            {% else %}
                                Member
                            {% endif %}
                        </td>
                        <td>
                            {% if not m.is_captain %}
                            <a href="{% url 'accounts:set_team_captain' team.id m.id %}">
                                Make Captain
                            </a>
                            {% endif %}
                            |
                            <a href="{% url 'accounts:remove_team_member' team.id m.id %}"
                               onclick="return confirm('Remove this member?')">
                               âŒ Remove
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <p style="color:var(--text-secondary);">
            No members added yet.
        </p>
        {% endif %}
    </div>

</div>
{% endblock %}
