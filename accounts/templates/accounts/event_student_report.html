{% extends 'accounts/dashboards/base_dashboard.html' %}

{% block title %}Event Registrations{% endblock %}
{% block page_title %}ğŸ“‹ Event Registration Reports{% endblock %}
{% block page_subtitle %}
Individual & Team Event Registrations
{% endblock %}

{% block content %}
<div class="dashboard-grid">

    <!-- Search -->
    <div class="glass-card" style="grid-column: span 2;">
        <form method="get">
            <div style="display:flex; gap:10px; max-width:600px;">
                <input type="text"
                       name="q"
                       value="{{ query }}"
                       placeholder="Search by name or register number"
                       style="flex:1;">
                <button type="submit" class="btn-action">ğŸ” Search</button>
                <a href="{% url 'accounts:faculty_coordinator_dashboard' %}"
                   class="btn-action btn-outline">
                    â¬… Back
                </a>
            </div>
        </form>
    </div>

    <!-- ================= INDIVIDUAL EVENTS ================= -->
    <div class="glass-card" style="grid-column: span 2;">
        <h3>ğŸ‘¤ Individual Events</h3>
    </div>

    {% for item in individual_events %}
    <div class="glass-card" style="grid-column: span 2;">
        <div class="card-header">
            <h3 class="card-title">
                {{ item.event.name }} ({{ item.meet_event.meet.name }})
            </h3>
            <a href="{% url 'accounts:download_individual_event_pdf' item.meet_event.id %}"
               class="btn-action btn-outline">
                â¬‡ PDF
            </a>
        </div>

        <table class="table">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Register No</th>
                    <th>Department</th>
                    <th>Gender</th>
                </tr>
            </thead>
            <tbody>
                {% for reg in item.registrations %}
                <tr>
                    <td>{{ reg.participant.full_name }}</td>
                    <td>{{ reg.participant.register_number }}</td>
                    <td>{{ reg.participant.department.name }}</td>
                    <td>{{ reg.participant.gender }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% empty %}
    <p style="grid-column: span 2; color:var(--text-secondary);">
        No individual registrations
    </p>
    {% endfor %}

    <!-- ================= TEAM EVENTS ================= -->
    <div class="glass-card" style="grid-column: span 2; margin-top:20px;">
        <h3>ğŸ‘¥ Team Events</h3>
    </div>

    {% for item in team_events %}
    <div class="glass-card" style="grid-column: span 2;">
        <h3>
            {{ item.event.name }} ({{ item.meet_event.meet.name }})
        </h3>

        {% for team in item.teams %}
        <div style="margin-top:15px;">
            <strong>Team: {{ team.name }}</strong>

            <a href="{% url 'accounts:download_team_pdf' team.id %}"
               class="btn-action btn-outline"
               style="margin-top:5px;">
                â¬‡ Team PDF
            </a>

            <table class="table" style="margin-top:10px;">
                <tr>
                    <th>Name</th>
                    <th>Register No</th>
                    <th>Role</th>
                </tr>
                {% for m in team.teammember_set.all %}
                <tr>
                    <td>{{ m.student.full_name }}</td>
                    <td>{{ m.student.register_number }}</td>
                    <td>{% if m.is_captain %}Captain â­{% else %}Member{% endif %}</td>
                </tr>
                {% endfor %}
            </table>
        </div>
        {% endfor %}
    </div>
    {% empty %}
    <p style="grid-column: span 2; color:var(--text-secondary);">
        No team registrations
    </p>
    {% endfor %}

</div>
{% endblock %}
