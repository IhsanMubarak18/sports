{% extends 'accounts/dashboards/base_dashboard.html' %}

{% block title %}Event Registrations | Sports Meet{% endblock %}

{% block page_title %}ğŸ“‹ Event â†’ Registered Students{% endblock %}
{% block page_subtitle %}
View students registered for each event
{% endblock %}

{% block content %}
<div class="dashboard-grid">

    <!-- Search -->
    <div class="glass-card" style="grid-column: span 2;">
        <form method="get">
            <div style="display:flex; gap:10px; max-width:500px;">
                <input type="text" name="q" value="{{ query }}" placeholder="Search by name or register number"
                    style="flex:1;">
                <button type="submit" class="btn-action">
                    ğŸ” Search
                </button>
                <!-- Back button -->
                {% if request.user.role == 'FACULTY_COORDINATOR' %}
                <a href="{% url 'accounts:faculty_coordinator_dashboard' %}" class="btn-action btn-outline">â¬… Back to
                    Dashboard</a>
                {% elif request.user.role == 'FACULTY' %}
                <a href="{% url 'accounts:faculty_dashboard' %}" class="btn-action btn-outline">â¬… Back to Dashboard</a>
                {% elif request.user.role == 'ADMIN' %}
                <a href="{% url 'accounts:admin_dashboard' %}" class="btn-action btn-outline">â¬… Back to Dashboard</a>
                {% endif %}
            </div>
        </form>
    </div>

    <!-- Event-wise Registrations -->
    {% for item in events %}
    <div class="glass-card" style="grid-column: span 2; margin-bottom:20px;">
        <div class="card-header">
            <h3 class="card-title">
                ğŸŸï¸ {{ item.event.name }}
            </h3>
            <div style="display:flex; align-items:center; gap:10px;">
                <span style="font-size:0.85rem; color:var(--text-secondary);">
                    Meet: {{ item.meet_event.meet.name }}
                </span>
                <a href="{% url 'accounts:download_boys_report_pdf' item.meet_event.id %}" class="btn-action"
                    style="margin-top:0; width:auto; padding:0.4rem 0.8rem; font-size:0.85rem; background: linear-gradient(45deg, #3b82f6, #6366f1);">
                    ğŸ‘¦ Boys PDF
                </a>
                <a href="{% url 'accounts:download_girls_report_pdf' item.meet_event.id %}" class="btn-action"
                    style="margin-top:0; width:auto; padding:0.4rem 0.8rem; font-size:0.85rem; background: linear-gradient(45deg, #ec4899, #a855f7);">
                    ğŸ‘§ Girls PDF
                </a>
            </div>
        </div>

        <div class="gender-sections"
            style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 20px;">
            <!-- Boys Section -->
            <div class="gender-card">
                <h4
                    style="margin: 15px 0 10px; color: var(--accent-primary); border-bottom: 1px solid var(--glass-border); padding-bottom: 5px;">
                    ğŸ‘¦ Boys
                </h4>
                {% if item.boys %}
                <div style="overflow-x:auto;">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Register No</th>
                                <th>Dept</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for reg in item.boys %}
                            <tr>
                                <td>{{ reg.participant.full_name }}</td>
                                <td>{{ reg.participant.register_number }}</td>
                                <td>{{ reg.participant.department.name }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <p style="color:var(--text-secondary); padding:10px; font-size: 0.9rem;">None</p>
                {% endif %}
            </div>

            <!-- Girls Section -->
            <div class="gender-card">
                <h4
                    style="margin: 15px 0 10px; color: var(--accent-secondary); border-bottom: 1px solid var(--glass-border); padding-bottom: 5px;">
                    ğŸ‘§ Girls
                </h4>
                {% if item.girls %}
                <div style="overflow-x:auto;">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Register No</th>
                                <th>Dept</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for reg in item.girls %}
                            <tr>
                                <td>{{ reg.participant.full_name }}</td>
                                <td>{{ reg.participant.register_number }}</td>
                                <td>{{ reg.participant.department.name }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <p style="color:var(--text-secondary); padding:10px; font-size: 0.9rem;">None</p>
                {% endif %}
            </div>
        </div>
    </div>
    {% empty %}
    <div class="glass-card" style="grid-column: span 2;">
        <p style="color:var(--text-secondary); text-align:center;">
            No matching registrations found
        </p>
    </div>
    {% endfor %}

</div>
{% endblock %}